import{useRef as n,useState as e,useEffect as r,useCallback as o}from"react";import{Scribe as t,RealtimeEvents as i,Conversation as u}from"@elevenlabs/client";export{AudioFormat,CommitStrategy,RealtimeEvents,postOverallFeedback}from"@elevenlabs/client";function l(){return l=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var r=arguments[e];for(var o in r)({}).hasOwnProperty.call(r,o)&&(n[o]=r[o])}return n},l.apply(null,arguments)}function c(u){void 0===u&&(u={});var c=u.onSessionStarted,a=u.onPartialTranscript,s=u.onCommittedTranscript,d=u.onCommittedTranscriptWithTimestamps,v=u.onError,m=u.onAuthError,f=u.onQuotaExceededError,h=u.onCommitThrottledError,g=u.onTranscriberError,p=u.onUnacceptedTermsError,T=u.onRateLimitedError,C=u.onInputError,S=u.onQueueOverflowError,E=u.onResourceExhaustedError,M=u.onSessionTimeLimitExceededError,I=u.onChunkSizeExceededError,D=u.onInsufficientAudioActivityError,A=u.onConnect,R=u.onDisconnect,b=u.token,P=u.modelId,w=u.baseUri,y=u.commitStrategy,O=u.vadSilenceThresholdSecs,U=u.vadThreshold,k=u.minSpeechDurationMs,F=u.minSilenceDurationMs,_=u.languageCode,x=u.microphone,N=u.audioFormat,V=u.sampleRate,L=u.autoConnect,q=void 0!==L&&L,j=u.includeTimestamps,B=n(null),H=e("disconnected"),Q=H[0],W=H[1],X=e(""),z=X[0],K=X[1],Y=e([]),Z=Y[0],G=Y[1],J=e(null),$=J[0],nn=J[1];r(function(){return function(){var n;null==(n=B.current)||n.close()}},[]);var en=o(function(n){void 0===n&&(n={});try{if(B.current)return console.warn("Already connected"),Promise.resolve();try{var e,r;W("connecting"),nn(null);var o=n.token||b,u=n.modelId||P;if(!o)throw new Error("Token is required");if(!u)throw new Error("Model ID is required");var l,L=n.microphone||x,q=n.audioFormat||N,H=n.sampleRate||V,Q=null!=(e=null!=(r=n.includeTimestamps)?r:j)?e:!(!n.onCommittedTranscriptWithTimestamps&&!d);if(L)l=t.connect({token:o,modelId:u,baseUri:n.baseUri||w,commitStrategy:n.commitStrategy||y,vadSilenceThresholdSecs:n.vadSilenceThresholdSecs||O,vadThreshold:n.vadThreshold||U,minSpeechDurationMs:n.minSpeechDurationMs||k,minSilenceDurationMs:n.minSilenceDurationMs||F,languageCode:n.languageCode||_,microphone:L,includeTimestamps:Q});else{if(!q||!H)throw new Error("Either microphone options or (audioFormat + sampleRate) must be provided");l=t.connect({token:o,modelId:u,baseUri:n.baseUri||w,commitStrategy:n.commitStrategy||y,vadSilenceThresholdSecs:n.vadSilenceThresholdSecs||O,vadThreshold:n.vadThreshold||U,minSpeechDurationMs:n.minSpeechDurationMs||k,minSilenceDurationMs:n.minSilenceDurationMs||F,languageCode:n.languageCode||_,includeTimestamps:Q,audioFormat:q,sampleRate:H})}B.current=l,l.on(i.SESSION_STARTED,function(){W("connected"),null==c||c()}),l.on(i.PARTIAL_TRANSCRIPT,function(n){var e=n;K(e.text),W("transcribing"),null==a||a(e)}),l.on(i.COMMITTED_TRANSCRIPT,function(n){var e=n,r={id:Date.now()+"-"+Math.random(),text:e.text,timestamp:Date.now(),isFinal:!0};G(function(n){return[].concat(n,[r])}),K(""),null==s||s(e)}),l.on(i.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS,function(n){var e=n,r={id:Date.now()+"-"+Math.random(),text:e.text,timestamp:Date.now(),isFinal:!0,words:e.words};G(function(n){return[].concat(n,[r])}),K(""),null==d||d(e)}),l.on(i.ERROR,function(n){var e=n;nn(e.error),W("error"),null==v||v(new Error(e.error))}),l.on(i.AUTH_ERROR,function(n){var e=n;nn(e.error),W("error"),null==m||m(e)}),l.on(i.QUOTA_EXCEEDED,function(n){var e=n;nn(e.error),W("error"),null==f||f(e)}),l.on(i.COMMIT_THROTTLED,function(n){var e=n;nn(e.error),W("error"),null==h||h(e)}),l.on(i.TRANSCRIBER_ERROR,function(n){var e=n;nn(e.error),W("error"),null==g||g(e)}),l.on(i.UNACCEPTED_TERMS,function(n){var e=n;nn(e.error),W("error"),null==p||p(e)}),l.on(i.RATE_LIMITED,function(n){var e=n;nn(e.error),W("error"),null==T||T(e)}),l.on(i.INPUT_ERROR,function(n){var e=n;nn(e.error),W("error"),null==C||C(e)}),l.on(i.QUEUE_OVERFLOW,function(n){var e=n;nn(e.error),W("error"),null==S||S(e)}),l.on(i.RESOURCE_EXHAUSTED,function(n){var e=n;nn(e.error),W("error"),null==E||E(e)}),l.on(i.SESSION_TIME_LIMIT_EXCEEDED,function(n){var e=n;nn(e.error),W("error"),null==M||M(e)}),l.on(i.CHUNK_SIZE_EXCEEDED,function(n){var e=n;nn(e.error),W("error"),null==I||I(e)}),l.on(i.INSUFFICIENT_AUDIO_ACTIVITY,function(n){var e=n;nn(e.error),W("error"),null==D||D(e)}),l.on(i.OPEN,function(){null==A||A()}),l.on(i.CLOSE,function(){W("disconnected"),B.current=null,null==R||R()})}catch(n){var X=n instanceof Error?n.message:"Failed to connect";throw nn(X),W("error"),n}return Promise.resolve()}catch(n){return Promise.reject(n)}},[b,P,w,y,O,U,k,F,_,x,N,V,j,c,a,s,d,v,m,f,h,g,p,T,C,S,E,M,I,D,A,R]),rn=o(function(){var n;null==(n=B.current)||n.close(),B.current=null,W("disconnected")},[]),on=o(function(n,e){if(!B.current)throw new Error("Not connected to Scribe");B.current.send(l({audioBase64:n},e))},[]),tn=o(function(){if(!B.current)throw new Error("Not connected to Scribe");B.current.commit()},[]),un=o(function(){G([]),K("")},[]),ln=o(function(){return B.current},[]);return r(function(){q&&en()},[q,en]),{status:Q,isConnected:"connected"===Q||"transcribing"===Q,isTranscribing:"transcribing"===Q,partialTranscript:z,committedTranscripts:Z,error:$,connect:en,disconnect:rn,sendAudio:on,commit:tn,clearTranscripts:un,getConnection:ln}}var a=["micMuted","volume","serverLocation"];function s(n){switch(void 0===n&&(n="us"),n){case"eu-residency":case"in-residency":case"us":case"global":return n;default:return console.warn("[ConversationalAI] Invalid server-location: "+n+'. Defaulting to "us"'),"us"}}function d(n){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[n]}function v(n){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[n]}function m(o){void 0===o&&(o={});var t=o.micMuted,i=o.volume,c=o.serverLocation,m=function(n,e){if(null==n)return{};var r={};for(var o in n)if({}.hasOwnProperty.call(n,o)){if(-1!==e.indexOf(o))continue;r[o]=n[o]}return r}(o,a),f=n(null),h=n(null),g=n(!1),p=e("disconnected"),T=p[0],C=p[1],S=e(!1),E=S[0],M=S[1],I=e("listening"),D=I[0],A=I[1],R=n(t),b=n(i);return R.current=t,b.current=i,r(function(){var n;void 0!==t&&(null==f||null==(n=f.current)||n.setMicMuted(t))},[t]),r(function(){var n;void 0!==i&&(null==f||null==(n=f.current)||n.setVolume({volume:i}))},[i]),r(function(){return function(){var n;g.current=!0,h.current?h.current.then(function(n){return n.endSession()}):null==(n=f.current)||n.endSession()}},[]),{startSession:function(n){try{var e,r,o=function(e){return r?e:(g.current=!1,function(e,r){try{var o=(y=d(w=s((null==n?void 0:n.serverLocation)||c)),O=v(w),h.current=u.startSession(l({},null!=m?m:{},null!=n?n:{},{origin:y,livekitUrl:(null==n?void 0:n.livekitUrl)||(null==m?void 0:m.livekitUrl)||O,overrides:l({},null!=(t=null==m?void 0:m.overrides)?t:{},null!=(i=null==n?void 0:n.overrides)?i:{},{client:l({},null!=(a=null==m||null==(p=m.overrides)?void 0:p.client)?a:{},null!=(T=null==n||null==(S=n.overrides)?void 0:S.client)?T:{},{source:(null==n||null==(E=n.overrides)||null==(E=E.client)?void 0:E.source)||(null==m||null==(I=m.overrides)||null==(I=I.client)?void 0:I.source)||"react_sdk",version:(null==n||null==(D=n.overrides)||null==(D=D.client)?void 0:D.version)||(null==m||null==(P=m.overrides)||null==(P=P.client)?void 0:P.version)||"0.14.0"})}),onConnect:(null==n?void 0:n.onConnect)||(null==m?void 0:m.onConnect),onDisconnect:(null==n?void 0:n.onDisconnect)||(null==m?void 0:m.onDisconnect),onError:(null==n?void 0:n.onError)||(null==m?void 0:m.onError),onMessage:(null==n?void 0:n.onMessage)||(null==m?void 0:m.onMessage),onAudio:(null==n?void 0:n.onAudio)||(null==m?void 0:m.onAudio),onDebug:(null==n?void 0:n.onDebug)||(null==m?void 0:m.onDebug),onUnhandledClientToolCall:(null==n?void 0:n.onUnhandledClientToolCall)||(null==m?void 0:m.onUnhandledClientToolCall),onVadScore:(null==n?void 0:n.onVadScore)||(null==m?void 0:m.onVadScore),onInterruption:(null==n?void 0:n.onInterruption)||(null==m?void 0:m.onInterruption),onAgentToolRequest:(null==n?void 0:n.onAgentToolRequest)||(null==m?void 0:m.onAgentToolRequest),onAgentToolResponse:(null==n?void 0:n.onAgentToolResponse)||(null==m?void 0:m.onAgentToolResponse),onConversationMetadata:(null==n?void 0:n.onConversationMetadata)||(null==m?void 0:m.onConversationMetadata),onMCPToolCall:(null==n?void 0:n.onMCPToolCall)||(null==m?void 0:m.onMCPToolCall),onMCPConnectionStatus:(null==n?void 0:n.onMCPConnectionStatus)||(null==m?void 0:m.onMCPConnectionStatus),onAsrInitiationMetadata:(null==n?void 0:n.onAsrInitiationMetadata)||(null==m?void 0:m.onAsrInitiationMetadata),onAgentChatResponsePart:(null==n?void 0:n.onAgentChatResponsePart)||(null==m?void 0:m.onAgentChatResponsePart),onAudioAlignment:(null==n?void 0:n.onAudioAlignment)||(null==m?void 0:m.onAudioAlignment),onModeChange:function(e){var r,o=e.mode;A(o),null==(r=(null==n?void 0:n.onModeChange)||(null==m?void 0:m.onModeChange))||r({mode:o})},onStatusChange:function(e){var r,o=e.status;C(o),null==(r=(null==n?void 0:n.onStatusChange)||(null==m?void 0:m.onStatusChange))||r({status:o})},onCanSendFeedbackChange:function(e){var r,o=e.canSendFeedback;M(o),null==(r=(null==n?void 0:n.onCanSendFeedbackChange)||(null==m?void 0:m.onCanSendFeedbackChange))||r({canSendFeedback:o})}})),Promise.resolve(h.current).then(function(n){function e(n){return void 0!==R.current&&f.current.setMicMuted(R.current),void 0!==b.current&&f.current.setVolume({volume:b.current}),f.current.getId()}f.current=n;var r=function(){if(g.current)return Promise.resolve(f.current.endSession()).then(function(){throw f.current=null,h.current=null,new Error("Session cancelled during connection")})}();return r&&r.then?r.then(e):e()}))}catch(n){return r(!0,n)}var t,i,a,p,T,S,E,I,D,P,w,y,O;return o&&o.then?o.then(r.bind(null,!1),r.bind(null,!0)):r(!1,o)}(0,function(n,e){if(h.current=null,n)throw e;return e}))};if(null!=(e=f.current)&&e.isOpen())return Promise.resolve(f.current.getId());var t=function(){if(h.current)return Promise.resolve(h.current).then(function(n){var e=n.getId();return r=1,e})}();return Promise.resolve(t&&t.then?t.then(o):o(t))}catch(n){return Promise.reject(n)}},endSession:function(){try{g.current=!0;var n=h.current,e=f.current;f.current=null;var r=n?Promise.resolve(n).then(function(n){return Promise.resolve(n.endSession()).then(function(){})}):Promise.resolve(null==e?void 0:e.endSession()).then(function(){});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(n){return Promise.reject(n)}},setVolume:function(n){var e;null==(e=f.current)||e.setVolume({volume:n.volume})},getInputByteFrequencyData:function(){var n;return null==(n=f.current)?void 0:n.getInputByteFrequencyData()},getOutputByteFrequencyData:function(){var n;return null==(n=f.current)?void 0:n.getOutputByteFrequencyData()},getInputVolume:function(){var n,e;return null!=(n=null==(e=f.current)?void 0:e.getInputVolume())?n:0},getOutputVolume:function(){var n,e;return null!=(n=null==(e=f.current)?void 0:e.getOutputVolume())?n:0},sendFeedback:function(n){var e;null==(e=f.current)||e.sendFeedback(n)},getId:function(){var n;return null==(n=f.current)?void 0:n.getId()},sendContextualUpdate:function(n){var e;null==(e=f.current)||e.sendContextualUpdate(n)},sendUserMessage:function(n){var e;null==(e=f.current)||e.sendUserMessage(n)},sendUserActivity:function(){var n;null==(n=f.current)||n.sendUserActivity()},sendMCPToolApprovalResult:function(n,e){var r;null==(r=f.current)||r.sendMCPToolApprovalResult(n,e)},changeInputDevice:function(n){try{var e,r=function(n){if(e)return n;throw new Error("Device switching is only available for voice conversations")},o=function(){if(f.current&&"changeInputDevice"in f.current)return Promise.resolve(f.current.changeInputDevice(n)).then(function(n){return e=1,n})}();return Promise.resolve(o&&o.then?o.then(r):r(o))}catch(n){return Promise.reject(n)}},changeOutputDevice:function(n){try{var e,r=function(n){if(e)return n;throw new Error("Device switching is only available for voice conversations")},o=function(){if(f.current&&"changeOutputDevice"in f.current)return Promise.resolve(f.current.changeOutputDevice(n)).then(function(n){return e=1,n})}();return Promise.resolve(o&&o.then?o.then(r):r(o))}catch(n){return Promise.reject(n)}},status:T,canSendFeedback:E,micMuted:t,isSpeaking:"speaking"===D}}export{v as getLivekitUrlForLocation,d as getOriginForLocation,s as parseLocation,m as useConversation,c as useScribe};
//# sourceMappingURL=lib.module.js.map
