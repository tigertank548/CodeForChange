!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("react"),require("@elevenlabs/client")):"function"==typeof define&&define.amd?define(["exports","react","@elevenlabs/client"],n):n((e||self).react={},e.react,e.client)}(this,function(e,n,r){function t(){return t=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var r=arguments[n];for(var t in r)({}).hasOwnProperty.call(r,t)&&(e[t]=r[t])}return e},t.apply(null,arguments)}var o=["micMuted","volume","serverLocation"];function i(e){switch(void 0===e&&(e="us"),e){case"eu-residency":case"in-residency":case"us":case"global":return e;default:return console.warn("[ConversationalAI] Invalid server-location: "+e+'. Defaulting to "us"'),"us"}}function u(e){return{us:"wss://api.elevenlabs.io","eu-residency":"wss://api.eu.residency.elevenlabs.io","in-residency":"wss://api.in.residency.elevenlabs.io",global:"wss://api.elevenlabs.io"}[e]}function l(e){return{us:"wss://livekit.rtc.elevenlabs.io","eu-residency":"wss://livekit.rtc.eu.residency.elevenlabs.io","in-residency":"wss://livekit.rtc.in.residency.elevenlabs.io",global:"wss://livekit.rtc.elevenlabs.io"}[e]}Object.defineProperty(e,"AudioFormat",{enumerable:!0,get:function(){return r.AudioFormat}}),Object.defineProperty(e,"CommitStrategy",{enumerable:!0,get:function(){return r.CommitStrategy}}),Object.defineProperty(e,"RealtimeEvents",{enumerable:!0,get:function(){return r.RealtimeEvents}}),Object.defineProperty(e,"postOverallFeedback",{enumerable:!0,get:function(){return r.postOverallFeedback}}),e.getLivekitUrlForLocation=l,e.getOriginForLocation=u,e.parseLocation=i,e.useConversation=function(e){void 0===e&&(e={});var c=e.micMuted,a=e.volume,s=e.serverLocation,d=function(e,n){if(null==e)return{};var r={};for(var t in e)if({}.hasOwnProperty.call(e,t)){if(-1!==n.indexOf(t))continue;r[t]=e[t]}return r}(e,o),v=n.useRef(null),m=n.useRef(null),f=n.useRef(!1),h=n.useState("disconnected"),E=h[0],g=h[1],p=n.useState(!1),S=p[0],C=p[1],T=n.useState("listening"),R=T[0],b=T[1],M=n.useRef(c),I=n.useRef(a);return M.current=c,I.current=a,n.useEffect(function(){var e;void 0!==c&&(null==v||null==(e=v.current)||e.setMicMuted(c))},[c]),n.useEffect(function(){var e;void 0!==a&&(null==v||null==(e=v.current)||e.setVolume({volume:a}))},[a]),n.useEffect(function(){return function(){var e;f.current=!0,m.current?m.current.then(function(e){return e.endSession()}):null==(e=v.current)||e.endSession()}},[]),{startSession:function(e){try{var n,o,c=function(n){return o?n:(f.current=!1,function(n,o){try{var c=(w=u(P=i((null==e?void 0:e.serverLocation)||s)),O=l(P),m.current=r.Conversation.startSession(t({},null!=d?d:{},null!=e?e:{},{origin:w,livekitUrl:(null==e?void 0:e.livekitUrl)||(null==d?void 0:d.livekitUrl)||O,overrides:t({},null!=(a=null==d?void 0:d.overrides)?a:{},null!=(h=null==e?void 0:e.overrides)?h:{},{client:t({},null!=(E=null==d||null==(p=d.overrides)?void 0:p.client)?E:{},null!=(S=null==e||null==(T=e.overrides)?void 0:T.client)?S:{},{source:(null==e||null==(R=e.overrides)||null==(R=R.client)?void 0:R.source)||(null==d||null==(y=d.overrides)||null==(y=y.client)?void 0:y.source)||"react_sdk",version:(null==e||null==(D=e.overrides)||null==(D=D.client)?void 0:D.version)||(null==d||null==(A=d.overrides)||null==(A=A.client)?void 0:A.version)||"0.14.0"})}),onConnect:(null==e?void 0:e.onConnect)||(null==d?void 0:d.onConnect),onDisconnect:(null==e?void 0:e.onDisconnect)||(null==d?void 0:d.onDisconnect),onError:(null==e?void 0:e.onError)||(null==d?void 0:d.onError),onMessage:(null==e?void 0:e.onMessage)||(null==d?void 0:d.onMessage),onAudio:(null==e?void 0:e.onAudio)||(null==d?void 0:d.onAudio),onDebug:(null==e?void 0:e.onDebug)||(null==d?void 0:d.onDebug),onUnhandledClientToolCall:(null==e?void 0:e.onUnhandledClientToolCall)||(null==d?void 0:d.onUnhandledClientToolCall),onVadScore:(null==e?void 0:e.onVadScore)||(null==d?void 0:d.onVadScore),onInterruption:(null==e?void 0:e.onInterruption)||(null==d?void 0:d.onInterruption),onAgentToolRequest:(null==e?void 0:e.onAgentToolRequest)||(null==d?void 0:d.onAgentToolRequest),onAgentToolResponse:(null==e?void 0:e.onAgentToolResponse)||(null==d?void 0:d.onAgentToolResponse),onConversationMetadata:(null==e?void 0:e.onConversationMetadata)||(null==d?void 0:d.onConversationMetadata),onMCPToolCall:(null==e?void 0:e.onMCPToolCall)||(null==d?void 0:d.onMCPToolCall),onMCPConnectionStatus:(null==e?void 0:e.onMCPConnectionStatus)||(null==d?void 0:d.onMCPConnectionStatus),onAsrInitiationMetadata:(null==e?void 0:e.onAsrInitiationMetadata)||(null==d?void 0:d.onAsrInitiationMetadata),onAgentChatResponsePart:(null==e?void 0:e.onAgentChatResponsePart)||(null==d?void 0:d.onAgentChatResponsePart),onAudioAlignment:(null==e?void 0:e.onAudioAlignment)||(null==d?void 0:d.onAudioAlignment),onModeChange:function(n){var r,t=n.mode;b(t),null==(r=(null==e?void 0:e.onModeChange)||(null==d?void 0:d.onModeChange))||r({mode:t})},onStatusChange:function(n){var r,t=n.status;g(t),null==(r=(null==e?void 0:e.onStatusChange)||(null==d?void 0:d.onStatusChange))||r({status:t})},onCanSendFeedbackChange:function(n){var r,t=n.canSendFeedback;C(t),null==(r=(null==e?void 0:e.onCanSendFeedbackChange)||(null==d?void 0:d.onCanSendFeedbackChange))||r({canSendFeedback:t})}})),Promise.resolve(m.current).then(function(e){function n(e){return void 0!==M.current&&v.current.setMicMuted(M.current),void 0!==I.current&&v.current.setVolume({volume:I.current}),v.current.getId()}v.current=e;var r=function(){if(f.current)return Promise.resolve(v.current.endSession()).then(function(){throw v.current=null,m.current=null,new Error("Session cancelled during connection")})}();return r&&r.then?r.then(n):n()}))}catch(e){return o(!0,e)}var a,h,E,p,S,T,R,y,D,A,P,w,O;return c&&c.then?c.then(o.bind(null,!1),o.bind(null,!0)):o(!1,c)}(0,function(e,n){if(m.current=null,e)throw n;return n}))};if(null!=(n=v.current)&&n.isOpen())return Promise.resolve(v.current.getId());var a=function(){if(m.current)return Promise.resolve(m.current).then(function(e){var n=e.getId();return o=1,n})}();return Promise.resolve(a&&a.then?a.then(c):c(a))}catch(e){return Promise.reject(e)}},endSession:function(){try{f.current=!0;var e=m.current,n=v.current;v.current=null;var r=e?Promise.resolve(e).then(function(e){return Promise.resolve(e.endSession()).then(function(){})}):Promise.resolve(null==n?void 0:n.endSession()).then(function(){});return Promise.resolve(r&&r.then?r.then(function(){}):void 0)}catch(e){return Promise.reject(e)}},setVolume:function(e){var n;null==(n=v.current)||n.setVolume({volume:e.volume})},getInputByteFrequencyData:function(){var e;return null==(e=v.current)?void 0:e.getInputByteFrequencyData()},getOutputByteFrequencyData:function(){var e;return null==(e=v.current)?void 0:e.getOutputByteFrequencyData()},getInputVolume:function(){var e,n;return null!=(e=null==(n=v.current)?void 0:n.getInputVolume())?e:0},getOutputVolume:function(){var e,n;return null!=(e=null==(n=v.current)?void 0:n.getOutputVolume())?e:0},sendFeedback:function(e){var n;null==(n=v.current)||n.sendFeedback(e)},getId:function(){var e;return null==(e=v.current)?void 0:e.getId()},sendContextualUpdate:function(e){var n;null==(n=v.current)||n.sendContextualUpdate(e)},sendUserMessage:function(e){var n;null==(n=v.current)||n.sendUserMessage(e)},sendUserActivity:function(){var e;null==(e=v.current)||e.sendUserActivity()},sendMCPToolApprovalResult:function(e,n){var r;null==(r=v.current)||r.sendMCPToolApprovalResult(e,n)},changeInputDevice:function(e){try{var n,r=function(e){if(n)return e;throw new Error("Device switching is only available for voice conversations")},t=function(){if(v.current&&"changeInputDevice"in v.current)return Promise.resolve(v.current.changeInputDevice(e)).then(function(e){return n=1,e})}();return Promise.resolve(t&&t.then?t.then(r):r(t))}catch(e){return Promise.reject(e)}},changeOutputDevice:function(e){try{var n,r=function(e){if(n)return e;throw new Error("Device switching is only available for voice conversations")},t=function(){if(v.current&&"changeOutputDevice"in v.current)return Promise.resolve(v.current.changeOutputDevice(e)).then(function(e){return n=1,e})}();return Promise.resolve(t&&t.then?t.then(r):r(t))}catch(e){return Promise.reject(e)}},status:E,canSendFeedback:S,micMuted:c,isSpeaking:"speaking"===R}},e.useScribe=function(e){void 0===e&&(e={});var o=e.onSessionStarted,i=e.onPartialTranscript,u=e.onCommittedTranscript,l=e.onCommittedTranscriptWithTimestamps,c=e.onError,a=e.onAuthError,s=e.onQuotaExceededError,d=e.onCommitThrottledError,v=e.onTranscriberError,m=e.onUnacceptedTermsError,f=e.onRateLimitedError,h=e.onInputError,E=e.onQueueOverflowError,g=e.onResourceExhaustedError,p=e.onSessionTimeLimitExceededError,S=e.onChunkSizeExceededError,C=e.onInsufficientAudioActivityError,T=e.onConnect,R=e.onDisconnect,b=e.token,M=e.modelId,I=e.baseUri,y=e.commitStrategy,D=e.vadSilenceThresholdSecs,A=e.vadThreshold,P=e.minSpeechDurationMs,w=e.minSilenceDurationMs,O=e.languageCode,k=e.microphone,U=e.audioFormat,F=e.sampleRate,_=e.autoConnect,x=void 0!==_&&_,L=e.includeTimestamps,N=n.useRef(null),V=n.useState("disconnected"),j=V[0],q=V[1],B=n.useState(""),H=B[0],Q=B[1],W=n.useState([]),X=W[0],z=W[1],K=n.useState(null),Y=K[0],Z=K[1];n.useEffect(function(){return function(){var e;null==(e=N.current)||e.close()}},[]);var G=n.useCallback(function(e){void 0===e&&(e={});try{if(N.current)return console.warn("Already connected"),Promise.resolve();try{var n,t;q("connecting"),Z(null);var _=e.token||b,x=e.modelId||M;if(!_)throw new Error("Token is required");if(!x)throw new Error("Model ID is required");var V,j=e.microphone||k,B=e.audioFormat||U,H=e.sampleRate||F,W=null!=(n=null!=(t=e.includeTimestamps)?t:L)?n:!(!e.onCommittedTranscriptWithTimestamps&&!l);if(j)V=r.Scribe.connect({token:_,modelId:x,baseUri:e.baseUri||I,commitStrategy:e.commitStrategy||y,vadSilenceThresholdSecs:e.vadSilenceThresholdSecs||D,vadThreshold:e.vadThreshold||A,minSpeechDurationMs:e.minSpeechDurationMs||P,minSilenceDurationMs:e.minSilenceDurationMs||w,languageCode:e.languageCode||O,microphone:j,includeTimestamps:W});else{if(!B||!H)throw new Error("Either microphone options or (audioFormat + sampleRate) must be provided");V=r.Scribe.connect({token:_,modelId:x,baseUri:e.baseUri||I,commitStrategy:e.commitStrategy||y,vadSilenceThresholdSecs:e.vadSilenceThresholdSecs||D,vadThreshold:e.vadThreshold||A,minSpeechDurationMs:e.minSpeechDurationMs||P,minSilenceDurationMs:e.minSilenceDurationMs||w,languageCode:e.languageCode||O,includeTimestamps:W,audioFormat:B,sampleRate:H})}N.current=V,V.on(r.RealtimeEvents.SESSION_STARTED,function(){q("connected"),null==o||o()}),V.on(r.RealtimeEvents.PARTIAL_TRANSCRIPT,function(e){var n=e;Q(n.text),q("transcribing"),null==i||i(n)}),V.on(r.RealtimeEvents.COMMITTED_TRANSCRIPT,function(e){var n=e,r={id:Date.now()+"-"+Math.random(),text:n.text,timestamp:Date.now(),isFinal:!0};z(function(e){return[].concat(e,[r])}),Q(""),null==u||u(n)}),V.on(r.RealtimeEvents.COMMITTED_TRANSCRIPT_WITH_TIMESTAMPS,function(e){var n=e,r={id:Date.now()+"-"+Math.random(),text:n.text,timestamp:Date.now(),isFinal:!0,words:n.words};z(function(e){return[].concat(e,[r])}),Q(""),null==l||l(n)}),V.on(r.RealtimeEvents.ERROR,function(e){var n=e;Z(n.error),q("error"),null==c||c(new Error(n.error))}),V.on(r.RealtimeEvents.AUTH_ERROR,function(e){var n=e;Z(n.error),q("error"),null==a||a(n)}),V.on(r.RealtimeEvents.QUOTA_EXCEEDED,function(e){var n=e;Z(n.error),q("error"),null==s||s(n)}),V.on(r.RealtimeEvents.COMMIT_THROTTLED,function(e){var n=e;Z(n.error),q("error"),null==d||d(n)}),V.on(r.RealtimeEvents.TRANSCRIBER_ERROR,function(e){var n=e;Z(n.error),q("error"),null==v||v(n)}),V.on(r.RealtimeEvents.UNACCEPTED_TERMS,function(e){var n=e;Z(n.error),q("error"),null==m||m(n)}),V.on(r.RealtimeEvents.RATE_LIMITED,function(e){var n=e;Z(n.error),q("error"),null==f||f(n)}),V.on(r.RealtimeEvents.INPUT_ERROR,function(e){var n=e;Z(n.error),q("error"),null==h||h(n)}),V.on(r.RealtimeEvents.QUEUE_OVERFLOW,function(e){var n=e;Z(n.error),q("error"),null==E||E(n)}),V.on(r.RealtimeEvents.RESOURCE_EXHAUSTED,function(e){var n=e;Z(n.error),q("error"),null==g||g(n)}),V.on(r.RealtimeEvents.SESSION_TIME_LIMIT_EXCEEDED,function(e){var n=e;Z(n.error),q("error"),null==p||p(n)}),V.on(r.RealtimeEvents.CHUNK_SIZE_EXCEEDED,function(e){var n=e;Z(n.error),q("error"),null==S||S(n)}),V.on(r.RealtimeEvents.INSUFFICIENT_AUDIO_ACTIVITY,function(e){var n=e;Z(n.error),q("error"),null==C||C(n)}),V.on(r.RealtimeEvents.OPEN,function(){null==T||T()}),V.on(r.RealtimeEvents.CLOSE,function(){q("disconnected"),N.current=null,null==R||R()})}catch(e){var X=e instanceof Error?e.message:"Failed to connect";throw Z(X),q("error"),e}return Promise.resolve()}catch(e){return Promise.reject(e)}},[b,M,I,y,D,A,P,w,O,k,U,F,L,o,i,u,l,c,a,s,d,v,m,f,h,E,g,p,S,C,T,R]),J=n.useCallback(function(){var e;null==(e=N.current)||e.close(),N.current=null,q("disconnected")},[]),$=n.useCallback(function(e,n){if(!N.current)throw new Error("Not connected to Scribe");N.current.send(t({audioBase64:e},n))},[]),ee=n.useCallback(function(){if(!N.current)throw new Error("Not connected to Scribe");N.current.commit()},[]),ne=n.useCallback(function(){z([]),Q("")},[]),re=n.useCallback(function(){return N.current},[]);return n.useEffect(function(){x&&G()},[x,G]),{status:j,isConnected:"connected"===j||"transcribing"===j,isTranscribing:"transcribing"===j,partialTranscript:H,committedTranscripts:X,error:Y,connect:G,disconnect:J,sendAudio:$,commit:ee,clearTranscripts:ne,getConnection:re}}});
//# sourceMappingURL=lib.umd.js.map
